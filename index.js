function ze(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function me(n,e){for(var t=0;t<e.length;t++){var r=e[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(n,r.key,r)}}function Ye(n,e,t){return e&&me(n.prototype,e),t&&me(n,t),n}var f=function(){function n(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;ze(this,n),this.x=e,this.y=t}return Ye(n,[{key:"add",value:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:void 0,i=n.from(t,r);return new n(this.x+i.x,this.y+i.y)}},{key:"subtract",value:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:void 0,i=n.from(t,r);return new n(this.x-i.x,this.y-i.y)}},{key:"multiply",value:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:void 0,i=n.from(t,r);return new n(this.x*i.x,this.y*i.y)}},{key:"divide",value:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:void 0,i=n.from(t,r);return new n(this.x/i.x,this.y/i.y)}},{key:"mod",value:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:void 0,i=n.from(t,r);return new n(this.x%i.x,this.y%i.y)}},{key:"ceil",value:function(){return new n(Math.ceil(this.x),Math.ceil(this.y))}},{key:"floor",value:function(){return new n(Math.floor(this.x),Math.floor(this.y))}},{key:"round",value:function(){return new n(Math.fround(this.x),Math.fround(this.y))}},{key:"abs",value:function(){return new n(Math.abs(this.x),Math.abs(this.y))}},{key:"reverse",value:function(){throw new n(-this.x,-this.y)}},{key:"flip",value:function(){throw new n(this.y,this.x)}},{key:"clone",value:function(){return new n(this.x,this.y)}},{key:"distance",value:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:void 0,i=n.from(t,r);return Math.sqrt(this.distanceSquared(i))}},{key:"distanceSquared",value:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:void 0,i=n.from(t,r);return Math.pow(this.x-i.x,2)+Math.pow(this.y-i.y,2)}}],[{key:"from",value:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:void 0;return typeof t=="number"?new n(t,typeof r=="number"?r:t):t instanceof n?t:t instanceof HTMLCanvasElement||t instanceof HTMLImageElement?new n(t.width,t.height):new n(t.w,t.h)}}]),n}();var pe=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||function(n){return window.setTimeout(n,1e3/60)}}(),Z=function(e,t,r,i){return new f(t,r).subtract(e.offsetLeft,e.offsetTop).multiply(i/e.offsetWidth)};function $e(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function de(n,e){for(var t=0;t<e.length;t++){var r=e[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(n,r.key,r)}}function Je(n,e,t){return e&&de(n.prototype,e),t&&de(n,t),n}var ye=function(){function n(e){var t=this;$e(this,n),this.activities=[],this.canvas=e;var r=this.canvas.getContext("2d");if(!r)throw"Can't get context from canvas";this.ctx=r,this.mouseVec=new f,this.elapsedSecs=0,this.lastUpdate=-1,this.ctx.webkitImageSmoothingEnabled=!1,this.ctx.mozImageSmoothingEnabled=!1,this.ctx.imageSmoothingEnabled=!1,this.canvas.onclick=function(i){if(i.button===0){var o=Z(t.canvas,i.pageX,i.pageY,1024);t.activities.slice().reverse().some(function(u){return u.mouseClick(o,o.add(u.camera))})}},this.canvas.onmousemove=function(i){t.mouseVec=Z(t.canvas,i.pageX,i.pageY,1024)}}return Je(n,[{key:"update",value:function(){var t=this,r=Date.now();if(this.lastUpdate!==-1){var i=this.lastUpdate===-1?0:r-this.lastUpdate;this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.activities=this.activities.filter(function(o){return o.isDestroyed?!1:(o.update(i),o.render(t.ctx),!0)})}this.lastUpdate=r,this.activities.slice().reverse().some(function(o){return o.mouseHover(t.mouseVec,t.mouseVec.add(o.camera))}),pe(this.update.bind(this))}},{key:"addActivity",value:function(t){this.activities.push(t)}}]),n}();function Ge(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function ge(n,e){for(var t=0;t<e.length;t++){var r=e[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(n,r.key,r)}}function Ke(n,e,t){return e&&ge(n.prototype,e),t&&ge(n,t),n}var m=function(){function n(){Ge(this,n),this._hidden=!1,this._absolute=!1,this._scale=1,this._rotate=0,this._hue=0,this._brightness=1,this._contrast=1,this._grayscale=!1,this._drawBox=null}return Ke(n,[{key:"hidden",value:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return this._hidden=t,this}},{key:"absolute",value:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return this._absolute=t,this}},{key:"scale",value:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:1;return this._scale=t,this}},{key:"rotate",value:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return this._rotate=t,this}},{key:"hue",value:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return this._hue=t,this}},{key:"brightness",value:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:1;return this._brightness=t,this}},{key:"contrast",value:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:1;return this._contrast=t,this}},{key:"grayscale",value:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return this._grayscale=t,this}},{key:"drawBox",value:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;return this._drawBox=t,this}},{key:"applyFilter",value:function(t){var r=t.filter==="none"?"":t.filter;this._rotate!==0&&t.rotate(-this._rotate),this._hue!==0&&(r+=" hue-rotate(".concat(this._hue,"deg) ")),this._brightness!==1&&(r+=" brightness(".concat(this._brightness,") ")),this._contrast!==1&&(r+=" contrast(".concat(this._contrast,") ")),this._grayscale&&(r+=" grayscale(1) "),this._drawBox&&(t.rect(this._drawBox.minX,this._drawBox.minY,this._drawBox.maxX,this._drawBox.maxY),t.clip(),t.clearRect(this._drawBox.minX,this._drawBox.minY,this._drawBox.maxX,this._drawBox.maxY)),t.filter=r}}]),n}();function Qe(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function ve(n,e){for(var t=0;t<e.length;t++){var r=e[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(n,r.key,r)}}function Ze(n,e,t){return e&&ve(n.prototype,e),t&&ve(n,t),n}var E=function(){function n(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:new m;Qe(this,n),this.children=[],this.renderOption=e??new m,this.isDestroyed=!1,this.hoverOutDelay=0,this.onUpdate=function(){},this.onRender=function(){},this.onDestroy=function(){},this.onMouseClick=function(){return!1},this.onMouseHover=function(){return!1},this.onMouseHoverOut=function(){},this.init()}return Ze(n,[{key:"init",value:function(){}},{key:"update",value:function(t){this.children=this.children.filter(function(r){return r.isDestroyed?!1:(r.update(t),!0)}),this.hoverOutDelay>0&&(this.hoverOutDelay-=t,this.hoverOutDelay<=0&&(this.hoverOutDelay=0,this.onMouseHoverOut(this))),this.onUpdate(t,this)}},{key:"render",value:function(t){if(!(this.isDestroyed||this.isHidden())){if(t.save(),this.renderOption.applyFilter(t),this.children.forEach(function(i){t.save(),i.render(t),t.restore()}),this.onRender(t,this),new URLSearchParams(window.location.search).get("renderBoundingBox")){var r=this.getBoundingBox();r&&(t.beginPath(),t.moveTo(r.minX,r.minY),t.lineTo(r.minX,r.maxY),t.lineTo(r.maxX,r.maxY),t.lineTo(r.maxX,r.minY),t.closePath(),t.stroke())}t.restore()}}},{key:"mouseClick",value:function(t,r){if(this.isDestroyed)return!1;var i=this.getBoundingBox();return i&&!i.isInside(this.isAbsolute()?t:r)?!1:this.onMouseClick(t,r,this)||this.children.slice().reverse().findIndex(function(o){return o.mouseClick(t,r)})!==-1}},{key:"mouseHover",value:function(t,r){if(this.isDestroyed)return!1;var i=this.getBoundingBox();return!i||!i.isInside(this.isAbsolute()?t:r)?!1:(this.hoverOutDelay=20,this.onMouseHover(t,r,this)||this.children.slice().reverse().findIndex(function(o){return o.mouseHover(t,r)})!==-1)}},{key:"destroy",value:function(){this.isDestroyed=!0,this.onDestroy(this)}},{key:"setOnUpdate",value:function(t){return this.onUpdate=t,this}},{key:"setOnRender",value:function(t){return this.onRender=t,this}},{key:"setOnMouseClick",value:function(t){return this.onMouseClick=t,this}},{key:"setOnMouseHover",value:function(t){return this.onMouseHover=t,this}},{key:"setOnMouseHoverOut",value:function(t){return this.onMouseHoverOut=t,this}},{key:"setRenderOption",value:function(t){return this.renderOption=t,this}},{key:"isAbsolute",value:function(){return this.renderOption._absolute}},{key:"isHidden",value:function(){return this.renderOption._hidden}},{key:"isHover",value:function(){return this.hoverOutDelay>0}},{key:"getScale",value:function(){return this.renderOption._scale}},{key:"getDrawBox",value:function(){return this.renderOption._drawBox}},{key:"getBoundingBox",value:function(){return null}}]),n}();function et(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function _e(n,e){for(var t=0;t<e.length;t++){var r=e[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(n,r.key,r)}}function tt(n,e,t){return e&&_e(n.prototype,e),t&&_e(n,t),n}var b=function(){function n(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:new f,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:new f;if(et(this,n),this.min=f.from(e),this.max=f.from(t),this.min.x>this.max.x){var r=[this.max.x,this.min.x];this.min.x=r[0],this.max.x=r[1]}if(this.min.y>this.max.y){var i=[this.max.y,this.min.y];this.min.y=i[0],this.max.y=i[1]}}return tt(n,[{key:"minX",get:function(){return this.min.x}},{key:"minY",get:function(){return this.min.y}},{key:"maxX",get:function(){return this.max.x}},{key:"maxY",get:function(){return this.max.y}},{key:"xLength",get:function(){return this.max.x-this.min.x}},{key:"yLength",get:function(){return this.max.y-this.min.y}},{key:"isInside",value:function(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:void 0,i=f.from(t,r);return this.min.x<i.x&&this.max.x>i.x&&this.min.y<i.y&&this.max.y>i.y}},{key:"add",value:function(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:void 0,i=f.from(t,r);return new n(this.min.add(i),this.max.add(i))}},{key:"subtract",value:function(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:void 0,i=f.from(t,r);return new n(this.min.subtract(i),this.max.subtract(i))}},{key:"expand",value:function(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:void 0,i=f.from(t,r);return new n(this.min.subtract(i),this.max.add(i))}},{key:"contract",value:function(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:void 0,i=f.from(t,r);return new n(this.min.add(i),this.max.subtract(i))}},{key:"ceil",value:function(){return n.from(this.min.ceil(),this.max.ceil())}},{key:"floor",value:function(){return n.from(this.min.floor(),this.max.floor())}},{key:"round",value:function(){return n.from(this.min.round(),this.max.round())}},{key:"clone",value:function(){return n.from(this.min,this.max)}}],[{key:"from",value:function(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:void 0,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:void 0,o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:void 0;return new n(f.from(t,i),f.from(r===void 0?t:r,o===void 0?i:o))}}]),n}();function I(n){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?I=function(t){return typeof t}:I=function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},I(n)}function nt(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function be(n,e){for(var t=0;t<e.length;t++){var r=e[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(n,r.key,r)}}function rt(n,e,t){return e&&be(n.prototype,e),t&&be(n,t),n}function it(n,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),e&&ee(n,e)}function ee(n,e){return ee=Object.setPrototypeOf||function(r,i){return r.__proto__=i,r},ee(n,e)}function at(n){var e=ut();return function(){var r=M(n),i;if(e){var o=M(this).constructor;i=Reflect.construct(r,arguments,o)}else i=r.apply(this,arguments);return ot(this,i)}}function ot(n,e){return e&&(I(e)==="object"||typeof e=="function")?e:st(n)}function st(n){if(n===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}function ut(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}function M(n){return M=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},M(n)}var we=function(n){it(t,n);var e=at(t);function t(r){var i;return nt(this,t),i=e.call(this),i.app=r,i.camera=new f,i}return rt(t,[{key:"addWidget",value:function(i){this.children.push(i),i.app=this.app,i.activity=this}},{key:"render",value:function(i){var o=this;this.isDestroyed||this.isHidden()||this.children.forEach(function(u){u.isAbsolute()||(i.save(),i.translate(-o.camera.x,-o.camera.y)),u.render(i),u.isAbsolute()||i.restore()})}},{key:"getBoundingBox",value:function(){return b.from(0,this.app.canvas)}},{key:"isAbsolute",value:function(){return!0}}]),t}(E);function A(n){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?A=function(t){return typeof t}:A=function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},A(n)}function ft(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function xe(n,e){for(var t=0;t<e.length;t++){var r=e[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(n,r.key,r)}}function lt(n,e,t){return e&&xe(n.prototype,e),t&&xe(n,t),n}function ct(n,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),e&&R(n,e)}function mt(n){var e=Oe();return function(){var r=P(n),i;if(e){var o=P(this).constructor;i=Reflect.construct(r,arguments,o)}else i=r.apply(this,arguments);return ht(this,i)}}function ht(n,e){return e&&(A(e)==="object"||typeof e=="function")?e:pt(n)}function pt(n){if(n===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}function te(n){var e=typeof Map=="function"?new Map:void 0;return te=function(r){if(r===null||!dt(r))return r;if(typeof r!="function")throw new TypeError("Super expression must either be null or a function");if(typeof e!="undefined"){if(e.has(r))return e.get(r);e.set(r,i)}function i(){return T(r,arguments,P(this).constructor)}return i.prototype=Object.create(r.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),R(i,r)},te(n)}function T(n,e,t){return Oe()?T=Reflect.construct:T=function(i,o,u){var a=[null];a.push.apply(a,o);var s=Function.bind.apply(i,a),h=new s;return u&&R(h,u.prototype),h},T.apply(null,arguments)}function Oe(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}function dt(n){return Function.toString.call(n).indexOf("[native code]")!==-1}function R(n,e){return R=Object.setPrototypeOf||function(r,i){return r.__proto__=i,r},R(n,e)}function P(n){return P=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},P(n)}var w=function(n){ct(t,n);var e=mt(t);function t(){return ft(this,t),e.apply(this,arguments)}return lt(t,[{key:"random",value:function(){var i=Array.from(this.values());return i[Math.floor(i.length*Math.random()<<0)]}}]),t}(te(Map));import yt from"../sprite/ui/text.png";import gt from"../sprite/ui/background.png";import vt from"../sprite/ui/icon.png";import _t from"../sprite/character/pink_man.png";import bt from"../sprite/character/mask_man.png";import wt from"../sprite/character/ninja_frog.png";import xt from"../sprite/character/virtual_guy.png";import Ot from"../sprite/particle/character_appearing.png";import kt from"../sprite/particle/collected_item.png";var ke=yt,Se=gt,Re=vt;var St=_t,Rt=bt,Pt=wt,Bt=xt,x=new w().set("PinkMan",St).set("MaskMan",Rt).set("NinjaFrog",Pt).set("VirtualGuy",Bt),tr=new w(x.entries()),jt=Ot,Et=kt,C=new w().set("CharacterAppearing",jt).set("CollectedItem",Et);function It(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function Pe(n,e){for(var t=0;t<e.length;t++){var r=e[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(n,r.key,r)}}function Mt(n,e,t){return e&&Pe(n.prototype,e),t&&Pe(n,t),n}var B=function(){function n(e){It(this,n);var t=e.w,r=e.h,i=e.sx,o=e.sy,u=e.ox,a=e.oy;this.w=t??0,this.h=r??0,this.sx=i??0,this.sy=o??0,this.ox=u??0,this.oy=a??0,this._image=null}return Mt(n,[{key:"getImage",value:function(){return this._image}},{key:"setImage",value:function(t){return t instanceof HTMLImageElement?this._image=t:typeof t=="string"?(this._image=new Image,this._image.src=t):this._image=null,this}},{key:"update",value:function(t){}},{key:"draw",value:function(t,r){var i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,o=this.getImage();if(!(!o||!o.complete||o.naturalHeight===0)){var u=f.from(r);t.save(),t.translate(u.x,u.y),t.drawImage(o,this.sx,this.sy,this.w,this.h,-this.ox*i/2,-this.oy*i/2,this.w*i,this.h*i),t.restore()}}}],[{key:"from",value:function(t,r,i,o,u,a){return new n({w:t,h:r,sx:i,sy:o,ox:u,oy:a})}}]),n}();import At from"../sprite/ui/text.json";import Tt from"../sprite/ui/background.json";import Ct from"../sprite/ui/icon.json";function ne(n,e){var t=new w;return e.forEach(function(r){var i;t.set((i=r.name)!==null&&i!==void 0?i:t.size+"",new B(r).setImage(n))}),t}var Be=ne(ke,At),re=ne(Se,Tt),F=ne(Re,Ct);function W(n){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?W=function(t){return typeof t}:W=function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},W(n)}function Ft(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function je(n,e){for(var t=0;t<e.length;t++){var r=e[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(n,r.key,r)}}function Wt(n,e,t){return e&&je(n.prototype,e),t&&je(n,t),n}function D(n,e,t){return typeof Reflect!="undefined"&&Reflect.get?D=Reflect.get:D=function(i,o,u){var a=Dt(i,o);if(!!a){var s=Object.getOwnPropertyDescriptor(a,o);return s.get?s.get.call(u):s.value}},D(n,e,t||n)}function Dt(n,e){for(;!Object.prototype.hasOwnProperty.call(n,e)&&(n=O(n),n!==null););return n}function Ht(n,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),e&&ie(n,e)}function ie(n,e){return ie=Object.setPrototypeOf||function(r,i){return r.__proto__=i,r},ie(n,e)}function Vt(n){var e=Nt();return function(){var r=O(n),i;if(e){var o=O(this).constructor;i=Reflect.construct(r,arguments,o)}else i=r.apply(this,arguments);return Lt(this,i)}}function Lt(n,e){return e&&(W(e)==="object"||typeof e=="function")?e:Ut(n)}function Ut(n){if(n===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}function Nt(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}function O(n){return O=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},O(n)}var y=function(n){Ht(t,n);var e=Vt(t);function t(r,i){var o;Ft(this,t);var u=i.fps,a=i.count;o=e.call(this,i),o.fps=u,o.frames=[],o.count=0,o.loop=-1,o.elapsedSecs=0,o.onAnimationEnd=function(){},o.setImage(r);for(var s=0;s<a;++s)o.frames[s]=B.from(o.w,o.h,o.sx+s*o.w,o.sy,o.ox,o.oy).setImage(r),++o.count;return o}return Wt(t,[{key:"setImage",value:function(i){return D(O(t.prototype),"setImage",this).call(this,i),this.frames.forEach(function(o){return o.setImage(i)}),this}},{key:"getCurrentFrame",value:function(){var i,o=this.frames[Math.floor(this.elapsedSecs/this.fps)];return o||(this.loop!==0?(this.loop!==-1&&--this.loop,this.elapsedSecs=0,o=this.frames[0]):(o=this.frames[this.frames.length-1],this.onAnimationEnd&&this.onAnimationEnd(this))),(i=o)!==null&&i!==void 0?i:null}},{key:"setFps",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:60;return this.fps=i,this}},{key:"setLoop",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:-1;return this.loop=i,this}},{key:"setOnAnimationEnd",value:function(i){return this.onAnimationEnd=i,this}},{key:"update",value:function(i){this.elapsedSecs+=i}},{key:"draw",value:function(i,o){var u=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,a=this.getCurrentFrame();a!==null&&a.draw(i,o,u)}},{key:"reset",value:function(){this.elapsedSecs=0}},{key:"clone",value:function(){return new t(this.getImage(),this)}}]),t}(B);import oe from"../sprite/character/default_character.animation.json";import qt from"../sprite/particle/collected_item.json";import Ee from"../sprite/particle/character_appearing.json";var k={idle:function(e){return new y(e??null,oe.idle)},run:function(e){return new y(e??null,oe.run)},hit:function(e){return new y(e??null,oe.hit)}},ue={in:function(){return new y(C.get("CharacterAppearing"),Ee.in)},out:function(){return new y(C.get("CharacterAppearing"),Ee.out)}},Ie=new y(C.get("CollectedItem"),qt);function H(n){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?H=function(t){return typeof t}:H=function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},H(n)}function Xt(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function Me(n,e){for(var t=0;t<e.length;t++){var r=e[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(n,r.key,r)}}function zt(n,e,t){return e&&Me(n.prototype,e),t&&Me(n,t),n}function Yt(n,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),e&&ae(n,e)}function ae(n,e){return ae=Object.setPrototypeOf||function(r,i){return r.__proto__=i,r},ae(n,e)}function Gt(n){var e=Jt();return function(){var r=L(n),i;if(e){var o=L(this).constructor;i=Reflect.construct(r,arguments,o)}else i=r.apply(this,arguments);return $t(this,i)}}function $t(n,e){return e&&(H(e)==="object"||typeof e=="function")?e:Kt(n)}function Kt(n){if(n===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}function Jt(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}function L(n){return L=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},L(n)}var N=function(n){Yt(t,n);var e=Gt(t);function t(){var r,i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:new m;return Xt(this,t),r=e.call(this,o),r.app=null,r.activity=null,r.pos=i??new f,r}return zt(t,[{key:"setPos",value:function(i){return this.pos=i,this}}]),t}(E);function V(n){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?V=function(t){return typeof t}:V=function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},V(n)}function Qt(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function Ae(n,e){for(var t=0;t<e.length;t++){var r=e[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(n,r.key,r)}}function Zt(n,e,t){return e&&Ae(n.prototype,e),t&&Ae(n,t),n}function en(n,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),e&&se(n,e)}function se(n,e){return se=Object.setPrototypeOf||function(r,i){return r.__proto__=i,r},se(n,e)}function rn(n){var e=nn();return function(){var r=U(n),i;if(e){var o=U(this).constructor;i=Reflect.construct(r,arguments,o)}else i=r.apply(this,arguments);return tn(this,i)}}function tn(n,e){return e&&(V(e)==="object"||typeof e=="function")?e:on(n)}function on(n){if(n===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}function nn(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}function U(n){return U=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},U(n)}var Te=8,Ce=10,q=function(n){en(t,n);var e=rn(t);function t(r,i){var o,u=arguments.length>2&&arguments[2]!==void 0?arguments[2]:new m;return Qt(this,t),o=e.call(this,r,u),o.text=i,o}return Zt(t,[{key:"init",value:function(){var i=this;this.onRender=function(o){for(var u=i.getScale()/2,a=Te*u,s=Ce*u,h=i.text.split(`
`),p=h.length,d=0;d<p;++d)for(var S=h[d],j=S.length,v=0;v<j;++v){var c=Be.get(S.charAt(v).toLowerCase());c&&c.draw(o,i.pos.subtract((j-v*2)*a,(p-d*2)*s),i.getScale())}}}},{key:"getBoundingBox",value:function(){var i=this.text.split(`
`),o=i.reduce(function(a,s){return Math.max(a,s.length)},0),u=f.from(o,i.length).multiply(Te,Ce).multiply(this.getScale()/2);return b.from(this.pos).expand(u)}},{key:"setText",value:function(i){return this.text=i,this}}]),t}(N);function X(n){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?X=function(t){return typeof t}:X=function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},X(n)}function un(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function Fe(n,e){for(var t=0;t<e.length;t++){var r=e[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(n,r.key,r)}}function an(n,e,t){return e&&Fe(n.prototype,e),t&&Fe(n,t),n}function sn(n,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),e&&fe(n,e)}function fe(n,e){return fe=Object.setPrototypeOf||function(r,i){return r.__proto__=i,r},fe(n,e)}function cn(n){var e=ln();return function(){var r=z(n),i;if(e){var o=z(this).constructor;i=Reflect.construct(r,arguments,o)}else i=r.apply(this,arguments);return fn(this,i)}}function fn(n,e){return e&&(X(e)==="object"||typeof e=="function")?e:hn(n)}function hn(n){if(n===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}function ln(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}function z(n){return z=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},z(n)}var _=function(n){sn(t,n);var e=cn(t);function t(r){var i,o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,u=arguments.length>2&&arguments[2]!==void 0?arguments[2]:new m;return un(this,t),i=e.call(this,r,u),i.sprite=o,i}return an(t,[{key:"init",value:function(){var i=this;this.onRender=function(o){if(!(!i.sprite||!i.sprite.getImage())){var u=f.from(i.sprite).multiply(i.getScale()/2);i.sprite.draw(o,i.pos.subtract(u),i.getScale())}},this.onUpdate=function(o){var u;(u=i.sprite)===null||u===void 0||u.update(o)}}},{key:"getBoundingBox",value:function(){if(!this.sprite)return null;var i=f.from(this.sprite).multiply(this.getScale()/2);return b.from(this.pos.subtract(new f(this.sprite.ox,this.sprite.oy).multiply(this.getScale()/2))).expand(i)}},{key:"setSprite",value:function(i){return this.sprite=i,this}}]),t}(N);function Y(n){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Y=function(t){return typeof t}:Y=function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Y(n)}function mn(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function We(n,e){for(var t=0;t<e.length;t++){var r=e[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(n,r.key,r)}}function pn(n,e,t){return e&&We(n.prototype,e),t&&We(n,t),n}function dn(n,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),e&&le(n,e)}function le(n,e){return le=Object.setPrototypeOf||function(r,i){return r.__proto__=i,r},le(n,e)}function vn(n){var e=gn();return function(){var r=$(n),i;if(e){var o=$(this).constructor;i=Reflect.construct(r,arguments,o)}else i=r.apply(this,arguments);return yn(this,i)}}function yn(n,e){return e&&(Y(e)==="object"||typeof e=="function")?e:_n(n)}function _n(n){if(n===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}function gn(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}function $(n){return $=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},$(n)}var De=function(n){dn(t,n);var e=vn(t);function t(){return mn(this,t),e.apply(this,arguments)}return pn(t,[{key:"init",value:function(){var i=this;this.onRender=function(o){var u;if(!(!i.activity||!i.sprite))for(var a=((u=i.getDrawBox())!==null&&u!==void 0?u:i.activity.getBoundingBox()).add(i.pos.mod(i.sprite)).expand(f.from(i.sprite).multiply(2)).floor(),s=a.min.x;s<a.max.x;s+=i.sprite.w)for(var h=a.min.y;h<a.max.y;h+=i.sprite.h)i.sprite.draw(o,new f(s,h),i.getScale())}}},{key:"getBoundingBox",value:function(){return this.getDrawBox()}},{key:"isAbsolute",value:function(){return!0}}]),t}(_);function wn(n,e,t){return t={path:e,exports:{},require:function(r,i){return bn(r,i??t.path)}},n(t,t.exports),t.exports}function bn(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}var He=wn(function(n){(function(){var e=typeof window!="undefined"&&typeof window.document!="undefined"?window.document:{},t=n.exports,r=function(){for(var u,a=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitCurrentFullScreenElement","webkitCancelFullScreen","webkitfullscreenchange","webkitfullscreenerror"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozFullScreenEnabled","mozfullscreenchange","mozfullscreenerror"],["msRequestFullscreen","msExitFullscreen","msFullscreenElement","msFullscreenEnabled","MSFullscreenChange","MSFullscreenError"]],s=0,h=a.length,p={};s<h;s++)if(u=a[s],u&&u[1]in e){for(s=0;s<u.length;s++)p[a[0][s]]=u[s];return p}return!1}(),i={change:r.fullscreenchange,error:r.fullscreenerror},o={request:function(u,a){return new Promise(function(s,h){var p=function(){this.off("change",p),s()}.bind(this);this.on("change",p),u=u||e.documentElement;var d=u[r.requestFullscreen](a);d instanceof Promise&&d.then(p).catch(h)}.bind(this))},exit:function(){return new Promise(function(u,a){if(!this.isFullscreen){u();return}var s=function(){this.off("change",s),u()}.bind(this);this.on("change",s);var h=e[r.exitFullscreen]();h instanceof Promise&&h.then(s).catch(a)}.bind(this))},toggle:function(u,a){return this.isFullscreen?this.exit():this.request(u,a)},onchange:function(u){this.on("change",u)},onerror:function(u){this.on("error",u)},on:function(u,a){var s=i[u];s&&e.addEventListener(s,a,!1)},off:function(u,a){var s=i[u];s&&e.removeEventListener(s,a,!1)},raw:r};if(!r){t?n.exports={isEnabled:!1}:window.screenfull={isEnabled:!1};return}Object.defineProperties(o,{isFullscreen:{get:function(){return Boolean(e[r.fullscreenElement])}},element:{enumerable:!0,get:function(){return e[r.fullscreenElement]}},isEnabled:{enumerable:!0,get:function(){return Boolean(e[r.fullscreenEnabled])}}}),t?n.exports=o:window.screenfull=o})()}),Le=He,Ne=He.isEnabled;function J(n){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?J=function(t){return typeof t}:J=function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},J(n)}function xn(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function On(n,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),e&&ce(n,e)}function ce(n,e){return ce=Object.setPrototypeOf||function(r,i){return r.__proto__=i,r},ce(n,e)}function Rn(n){var e=Sn();return function(){var r=G(n),i;if(e){var o=G(this).constructor;i=Reflect.construct(r,arguments,o)}else i=r.apply(this,arguments);return kn(this,i)}}function kn(n,e){return e&&(J(e)==="object"||typeof e=="function")?e:Pn(n)}function Pn(n){if(n===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}function Sn(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}function G(n){return G=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},G(n)}var Ve=function(e,t){return t.renderOption.scale(t.isHover()?3.3:3),!0},Ue=function(n){On(t,n);var e=Rn(t);function t(r){var i;xn(this,t),i=e.call(this,r);var o=new De(null,re.random()),u=k.idle(x.get("PinkMan")),a=k.run(x.get("PinkMan"));u.setLoop(4).setOnAnimationEnd(function(){return s.sprite=a.setLoop(6)}),a.setLoop(6).setOnAnimationEnd(function(){return s.sprite=u.setLoop(4)});var s=new _(f.from(i.app.canvas).multiply(.25,.175),a,new m().absolute().scale(3)),h=new q(f.from(i.app.canvas).multiply(.5,.1),"random race",new m().absolute().scale(5)),p=new _(f.from(i.app.canvas).multiply(.95,.1),F.get("reset"),new m().absolute().scale(3));if(i.addWidget(o.setOnUpdate(function(c){o.pos.x-=c/10})),i.addWidget(s.setOnMouseClick(function(c){u.fps-=3,a.fps-=3,u.fps<0&&(u.fps=100,a.fps=100),i.addWidget(new q(c.add(Math.random()*80-40,0),u.fps===100?"-100":"+3",new m().absolute()).setRenderOption(new m().scale(2).absolute().hue(Math.random()*360).brightness(6).contrast(2)).setOnUpdate(function(g,l){if(!(l instanceof q)){l.destroy();return}l.pos.y-=g/20,l.pos.y<0&&l.destroy()}))})),i.addWidget(h),i.addWidget(p.setOnMouseClick(function(){var c,g;return o.setSprite(re.random()),s.setSprite(k.hit((c=(g=s.sprite)===null||g===void 0?void 0:g.getImage())!==null&&c!==void 0?c:null).setLoop(1).setOnAnimationEnd(function(){s.setSprite(ue.in().setLoop(0).setOnAnimationEnd(function(){var l=x.random();u.setImage(l),a.setImage(l),s.sprite=u.setLoop(1)}))})),!0}).setOnUpdate(Ve)),Ne){var d=Le,S=new _(p.pos.subtract(72,0),F.get("fullscreen_enter"),new m().absolute().scale(3));i.addWidget(S.setOnMouseClick(function(){return d.toggle(document.body)||!0}).setOnUpdate(Ve)),d.on("change",function(){var c;S.sprite=(c=F.get(d.isFullscreen?"fullscreen_exit":"fullscreen_enter"))!==null&&c!==void 0?c:null})}for(var j=function(g){var l=new _(new f(Math.random()*i.app.canvas.width,i.app.canvas.height));i.addWidget(l.setOnUpdate(function(he){var K,Q,Xe=i.getBoundingBox().add(i.camera).maxX;((K=(Q=l.getBoundingBox())===null||Q===void 0?void 0:Q.minX)!==null&&K!==void 0?K:0)>Xe&&(l.pos.x=i.camera.x,l.sprite=null),l.sprite||(l.renderOption.scale(Math.random()*5+2.5),l.sprite=k.run(x.random()).setFps(Math.random()*60+30)),l.sprite instanceof y&&l.sprite.loop===-1&&(l.pos.x+=he/5*(60/l.sprite.fps)),l.sprite.update(he)}).setOnMouseClick(function(){if(l.sprite instanceof y&&l.sprite.loop===-1)return l.setSprite(k.hit(l.sprite.getImage()).setLoop(0).setOnAnimationEnd(function(){l.setSprite(ue.out().setLoop(0).setOnAnimationEnd(function(){l.pos.x=i.camera.x,l.sprite=null}))})),!0}))},v=0;v<30;++v)j(v);return new URLSearchParams(window.location.search).get("renderMouseClick")&&i.setOnMouseClick(function(c){var g=Ie.clone().setLoop(0),l=new _(c,g,new m().absolute());g.setOnAnimationEnd(function(){return l.destroy()}),i.addWidget(l)}),i.setOnUpdate(function(c){i.camera.x+=c/10}),i}return t}(we);var qe=function(){Array.prototype.random=function(){var n=this.slice();return n[Math.floor(n.length*Math.random()<<0)]},Map.prototype.random=function(){return Array.from(this.values()).random()},Object.prototype.randomProperty=function(){return this[Object.keys(this).random()]},Object.prototype.clone=function(){var n=this,e={};return Object.keys(this).forEach(function(t){return e[t]=n[t]}),e}};qe();document.addEventListener("DOMContentLoaded",function(){var n=document.getElementById("game");if(!(n instanceof HTMLCanvasElement))throw"Can't get canvas element";var e=new ye(n);e.addActivity(new Ue(e)),e.update()});new Map;
/*!
* screenfull
* v5.1.0 - 2020-12-24
* (c) Sindre Sorhus; MIT License
*/
//# sourceMappingURL=//.//index.js.map
